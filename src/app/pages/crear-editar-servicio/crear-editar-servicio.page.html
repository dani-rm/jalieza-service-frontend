<app-navbar [title]="obtenerTitulo()"></app-navbar>

<ion-content id="main-content">
    <div class="grid-wrapper">
        <ion-grid class="grid-center">
            <ion-row class="ion-justify-content-center">
                <ion-col size="12" size-md="11" size-lg="11" size-xl="10">
                    <div class="contenedor-formulario">

                        <!-- Encabezado con botón volver -->
                        <ion-toolbar class="cabeza">
                            <ion-title class="titulo-contenedor">{{ obtenerTitulo() }}</ion-title>
                        </ion-toolbar>

                        <!-- Estado de carga -->
                        <div *ngIf="cargando" class="estado-carga">
                            <ion-text class="ion-text-center">
                                <p>Cargando datos...</p>
                            </ion-text>
                        </div>

                        <!-- Error -->
                        <div *ngIf="error && !cargando" class="estado-error">
                            <ion-card color="danger">
                                <ion-card-content>
                                    <ion-text color="light">
                                        <p>{{ error }}</p>
                                    </ion-text>
                                </ion-card-content>
                            </ion-card>
                        </div>

                        <!-- Formulario -->
                        <form *ngIf="!cargando && !error" [formGroup]="servicioForm" (ngSubmit)="guardarServicio()">
                            <ion-grid class="grid-datos">
                                <!-- Nombre del servicio -->
                                <ion-row>
                                    <ion-col size="12">
                                        <div class="campo">
                                            <label class="etiqueta">Nombre del Servicio *</label>
                                            <ion-input formControlName="service_name"
                                                placeholder="Ej: barrendero, policía, presidente..."
                                                [class.ion-invalid]="esCampoInvalido('service_name')"
                                                [class.ion-touched]="servicioForm.get('service_name')?.touched">
                                            </ion-input>
                                            <ion-text *ngIf="esCampoInvalido('service_name')" color="danger">
                                                <p class="error-message">{{ obtenerMensajeError('service_name') }}
                                                </p>
                                            </ion-text>
                                        </div>
                                    </ion-col>
                                </ion-row>

                                <!-- Orden -->
                                <ion-row>
                                    <ion-col size="12">
                                        <div class="campo">
                                            <label class="etiqueta">Orden *</label>
                                            <ion-select formControlName="orden_id" placeholder="Seleccione una orden"
                                                [class.ion-invalid]="esCampoInvalido('orden_id')"
                                                [class.ion-touched]="servicioForm.get('orden_id')?.touched">
                                                <ion-select-option *ngFor="let orden of ordenes" [value]="orden.id">
                                                    {{ orden.order_name }} ({{ orden.required_points }} puntos)
                                                </ion-select-option>
                                            </ion-select>
                                            <ion-text *ngIf="esCampoInvalido('orden_id')" color="danger">
                                                <p class="error-message">{{ obtenerMensajeError('orden_id') }}</p>
                                            </ion-text>
                                        </div>
                                    </ion-col>
                                </ion-row>

                                <!-- Información adicional (solo en edición) -->
                                <ion-row *ngIf="esEdicion && servicio">
                                    <ion-col size="12" size-md="6">
                                        <div class="campo">
                                            <label class="etiqueta">Fecha de Creación</label>
                                            <ion-input [value]="servicio.created_at | date:'medium'"
                                                readonly></ion-input>
                                        </div>
                                    </ion-col>
                                    <ion-col size="12" size-md="6">
                                        <div class="campo">
                                            <label class="etiqueta">Última Actualización</label>
                                            <ion-input [value]="servicio.updated_at | date:'medium'"
                                                readonly></ion-input>
                                        </div>
                                    </ion-col>
                                </ion-row>

                                <!-- Botones de acción -->
                                <ion-row>
                                    <ion-col size="6" class="ion-text-start">
                                        <ion-button type="button" (click)="volver()" class="boton-volver"
                                            color="medium">
                                            <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
                                            Volver
                                        </ion-button>
                                    </ion-col>
                                    <ion-col size="6" class="ion-text-end">
                                        <ion-button type="submit" [disabled]="servicioForm.invalid || guardando"
                                            class="boton-guardar">
                                            <ion-icon *ngIf="!guardando" name="save-outline" slot="start"></ion-icon>
                                            <ion-icon *ngIf="guardando" name="checkmark-circle-outline"
                                                slot="start"></ion-icon>
                                            {{ guardando ? 'Guardando...' : obtenerTextoBoton() }}
                                        </ion-button>
                                    </ion-col>
                                </ion-row>
                            </ion-grid>
                        </form>

                    </div>
                </ion-col>
            </ion-row>
        </ion-grid>
    </div>
</ion-content>