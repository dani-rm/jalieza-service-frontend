<app-navbar
  [title]="ciudadano?.name + ' ' + ciudadano?.last_name_father+ ' ' + ciudadano?.last_name_mother"></app-navbar>

<ion-content id="main-content">
  <div class="grid-wrapper">
    <ion-grid class="grid-center">
      <ion-row class="ion-justify-content-center">
        <ion-col size="12" size-md="11" size-lg="11" size-xl="10">
          <div class="contenedor-ciudadano">

            <!-- Encabezado y Menú -->
            <ion-header>
              <ion-toolbar class="cabeza">
                <!-- Botones para móvil -->
                <ion-buttons slot="start">
                  <ion-button (click)="mostrarMenu = !mostrarMenu">
                    <ion-icon name="menu-outline" class="menu-icono"></ion-icon>
                  </ion-button>
                </ion-buttons>
                <ion-title class="titulo-contenedor">{{ seccionActual }}</ion-title>
                <ion-buttons slot="end">
                  <ng-container *ngIf="seccionActual === 'Cargos'; else espaciador">
                    <ion-button *ngIf="authService.getUserRole() !== '4'" (click)="agregarCargo()">
                      <ion-icon name="add-circle-outline" class="menu-icono"></ion-icon>
                    </ion-button>
                  </ng-container>
                  <ng-template #espaciador>
                    <ion-icon name="menu-outline" style="visibility: hidden; font-size: 3rem;"></ion-icon>
                  </ng-template>
                </ion-buttons>

                <!-- Menú horizontal para PC -->
                <div class="menu-horizontal">
                  <ion-button class="menu-tab" [class.active]="seccionActual === 'Datos Generales'"
                    (click)="cambiarSeccion('Datos Generales')">
                    Datos Generales
                  </ion-button>
                  <ion-button class="menu-tab" [class.active]="seccionActual === 'Cargos'"
                    (click)="cambiarSeccion('Cargos')">
                    Cargos
                  </ion-button>
                  <ion-button *ngIf="authService.getUserRole() !== '4' && !ciudadano?.deleted_at"
                    class="menu-tab eliminar-btn" (click)="eliminarCiudadano()">
                    Eliminar ciudadano
                  </ion-button>
                </div>
              </ion-toolbar>

              <!-- Menú flotante para móvil -->
              <div class="fondo-menu" *ngIf="mostrarMenu" (click)="mostrarMenu = false"></div>
              <div class="menu-flotante" *ngIf="mostrarMenu">
                <ion-list lines="none">
                  <ion-item button (click)="cambiarSeccion('Datos Generales')">
                    <ion-label>Datos Generales</ion-label>
                  </ion-item>
                  <ion-item button (click)="cambiarSeccion('Cargos')">
                    <ion-label>Cargos</ion-label>
                  </ion-item>
                  <ion-item *ngIf="authService.getUserRole() !== '4' && ciudadano?.deleted_at" button
                    (click)="restaurarCiudadano()" color="success">
                    <ion-label>Subir ciudadano</ion-label>
                  </ion-item>
                  <ion-item *ngIf="authService.getUserRole() !== '4' && !ciudadano?.deleted_at" button
                    (click)="eliminarCiudadano()" color="danger">
                    <ion-label>Eliminar ciudadano</ion-label>
                  </ion-item>
                </ion-list>
              </div>
            </ion-header>


            <!-- Sección Datos Generales -->
            <ng-container *ngIf="seccionActual === 'Datos Generales'">
              <ion-grid class="grid-datos">
                <ion-row>
                  <ion-col size="12" size-md="4">
                    <div class="campo">
                      <label class="etiqueta">Nombres</label>
                      <div class="valor-dato">{{ ciudadano?.name }}</div>
                    </div>
                  </ion-col>
                  <ion-col size="12" size-md="4">
                    <div class="campo">
                      <label class="etiqueta">Apellido Paterno</label>
                      <div class="valor-dato">{{ ciudadano?.last_name_father }}</div>
                    </div>
                  </ion-col>
                  <ion-col size="12" size-md="4">
                    <div class="campo">
                      <label class="etiqueta">Apellido Materno</label>
                      <div class="valor-dato">{{ ciudadano?.last_name_mother }}</div>
                    </div>
                  </ion-col>
                </ion-row>

                <ion-row>
                  <ion-col size="12" size-md="4">
                    <div class="campo">
                      <label class="etiqueta">Teléfono</label>
                      <div class="valor-dato">{{ ciudadano?.phone }}</div>
                    </div>
                  </ion-col>
                  <ion-col size="12" size-md="4">
                    <div class="campo">
                      <label class="etiqueta">Fecha de Nacimiento</label>
                      <div class="valor-dato">{{ ciudadano?.birth_date }}</div>
                    </div>
                  </ion-col>
                  <ion-col size="12" size-md="4">
                    <div class="campo">
                      <label class="etiqueta">Estado Civil</label>
                      <div class="valor-dato">{{ mostrarEstadoCivil(ciudadano) }}</div>
                    </div>
                  </ion-col>
                  <ion-col size="12" size-md="4">
                    <div class="campo">
                      <label class="etiqueta">Comentario</label>
                      <div class="valor-dato">{{ ciudadano?.comment || 'No hay comentario' }}</div>
                    </div>
                  </ion-col>
                </ion-row>

                <ion-row *ngIf="ciudadano?.partner">
                  <ion-col size="12">
                    <div class="campo">
                      <label class="etiqueta">
                        {{
                        ciudadano?.marital_status === 'Casado' ? 'Pareja' :''
                        }}
                      </label>
                      <div class="valor-dato">
                        {{ ciudadano?.partner?.name }} {{ ciudadano?.partner?.last_name_father }} {{
                        ciudadano?.partner?.last_name_mother }}
                      </div>
                    </div>
                  </ion-col>

                </ion-row>

                <div class="boton-contenedor">
                  <ion-button class="boton-volver" (click)="volver()">Volver</ion-button>
                  <ion-button *ngIf="authService.getUserRole() !== '4'" class="boton-editar"
                    (click)="editarDatos()">Editar</ion-button>
                </div>
              </ion-grid>
            </ng-container>

            <!-- Sección Cargos -->
            <ng-container *ngIf="seccionActual === 'Cargos'">
              <ion-grid class="grid-datos">
                <!-- Botón agregar cargo -->
                <ion-row *ngIf="authService.getUserRole() !== '4'">
                  <ion-col size="12">
                    <ion-button expand="block" class="boton-agregar-cargo" (click)="agregarCargo()">
                      <ion-icon name="add-circle-outline" slot="start"></ion-icon>
                      Agregar Cargo
                    </ion-button>
                  </ion-col>
                </ion-row>

                <ng-container *ngIf="cargos.length > 0; else sinCargos">
                  <!-- Encabezado de tabla -->
                  <ion-row class="tabla-header">
                    <ion-col size="12" size-md="3">
                      <div class="tabla-th">Servicio</div>
                    </ion-col>
                    <ion-col size="12" size-md="2">
                      <div class="tabla-th">Inicio</div>
                    </ion-col>
                    <ion-col size="12" size-md="2">
                      <div class="tabla-th">Fin</div>
                    </ion-col>
                    <ion-col size="12" size-md="2">
                      <div class="tabla-th">Estado</div>
                    </ion-col>
                    <ion-col size="12" size-md="3">
                      <div class="tabla-th">Acciones</div>
                    </ion-col>
                  </ion-row>

                  <!-- Filas de datos -->
                  <ion-row *ngFor="let cargo of cargos" class="tabla-row">
                    <ion-col size="12" size-md="3">
                      <div class="tabla-td">
                        <span class="tabla-label">Servicio:</span>
                        {{ cargo.service_name }}
                      </div>
                    </ion-col>
                    <ion-col size="12" size-md="2">
                      <div class="tabla-td">
                        <span class="tabla-label">Inicio:</span>
                        {{ cargo.start_date | date }}
                      </div>
                    </ion-col>
                    <ion-col size="12" size-md="2">
                      <div class="tabla-td">
                        <span class="tabla-label">Fin:</span>
                        {{ cargo.end_date | date }}
                      </div>
                    </ion-col>
                    <ion-col size="12" size-md="2">
                      <div class="tabla-td">
                        <span class="tabla-label">Estado:</span>
                        <span class="estado-badge" [class.en-curso]="cargo.service_status === 'en_curso'"
                          [class.completado]="cargo.service_status === 'completado'">
                          {{ cargo.service_status }}
                        </span>
                      </div>
                    </ion-col>
                    <ion-col size="12" size-md="3">
                      <div class="tabla-td">
                        <span class="tabla-label">Acciones:</span>
                        <ion-select *ngIf="authService.getUserRole() !== '4'" class="select-estado"
                          [(ngModel)]="cargo.service_status"
                          [disabled]="cargo.service_status === 'completado' || cargo.service_status === 'rechazado'"
                          (ionChange)="cambiarEstadoServicio(cargo, $event)" interface="alert">
                          <ion-select-option value="en_curso">En curso</ion-select-option>
                          <ion-select-option value="completado">Completado</ion-select-option>
                          <ion-select-option value="rechazado">Rechazó</ion-select-option>
                        </ion-select>
                        <span *ngIf="authService.getUserRole() === '4'" class="estado-texto">
                          {{ cargo.service_status }}
                        </span>
                      </div>
                    </ion-col>
                    <!-- Observaciones en fila completa si existen -->
                    <ion-col *ngIf="cargo.observations" size="12" class="observaciones-col">
                      <div class="observaciones-contenedor">
                        <strong>Observaciones:</strong> {{ cargo.observations }}
                      </div>
                    </ion-col>
                  </ion-row>
                </ng-container>

                <ng-template #sinCargos>
                  <ion-row>
                    <ion-col size="12">
                      <ion-text>
                        <p class="ion-text-center" style="color: black; font-size: 2rem;">Sin Cargos Ejercidos</p>
                      </ion-text>
                    </ion-col>
                  </ion-row>
                </ng-template>

                <div class="boton-contenedor">
                  <ion-button class="boton-volver" (click)="volver()">Volver</ion-button>
                  <!-- <ion-button *ngIf="authService.getUserRole() !== '4'" class="boton-editar" (click)="editarCargos()"
                    [disabled]="cargos.length === 0">Editar</ion-button> -->
                </div>
              </ion-grid>
            </ng-container>

          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>